import kotlinPuzzleLibrary.*

fun main(args: Array<String>) {
    val input =
"""
                                                                                                           |
   +-----+                                         +---------------------------------+               +-----|-------------------------------------------------------+       +-------------------+
   |     |                                         |                                 |               |     |                                                       |       |                   |
   |     |                                         |                                 |               |     |   +----Q--------------------------+                 +---------|-------------------|-+
   |     |                                         |                                 |               |     |   |                               |                 | |       |                   | |
   |     |     +---------------------+             +-+                               |               |     |   |                               |                 | |       |           +-------+ |
   |     |     |                     |               |                               |               |     |   |                               |                 | |       |           |         |
   |     |     |       +-------------------------------------------------------------|---------------|---------|-----+                 +-------+                 | |     +-|-+         |         |
   |     |     |       |             |               |                               |               |     |   |     |                 |                         | |     | | |         |         |
   |     |     +-+     |             |               |                               |               |     |   |     |                 |                         | |     | | |         |         |
   |     |       |     |             |               |                               |               |     |   |     |                 |                         | |     | | |         |         |
   |     |       |     |             |               |               +---------------|---------------|-----|-------------+             |                   +-------------+ | |         |   +-----|---+
   |     |       |     |             |               |               |               |               |     |   |     |   |             |                   |     | |       | |         |   |     |   |
   |     |       |     |             |   +-----------|---------------|---------------|-----------------------------------|---------------------------------|-----|-|-------|-|---------|---+     |   |
   |     |       |     |             |   |           |               |               |               |     |   |     |   |             |                   |     | |       | |         |         |   |
 +-------|-------|-----|-----------------------------|---------------+               |   +-----------|-----|---+     |   |         +---|--T----------------------|---------|---------------------------+
 | |     |       |     |             |   |           |                               |   |           |     |         |   |         |   |                   |     | |       | |         |         |   | |
 +-----+ |       |     |             |   |           |                               |   |           | +---|-----------------------|-------------------------------|-----+ | |         |   +---------+ |
   |   | |       |     |             |   |           |                               |   |           | |   |         |   |         |   |                   |     | |     | | |         |   |     |     |
   |   | |       |     |             |   |           |                               | +-------------|-|---------------------------|---|-----------------------------------|-|-----------+ |     | +-+ |
   |   | |       |     |             |   |           |                               | | |           | |   |         |   |         |   |                   |     | |     | | |         | | |     | | | |
   |   | |       |     |             |   |           |       +-----------------------|---|---------------------------|-------------------------------------------------------|---------+ +-+     | | +-+
   |   | |       |     |             |   |           |       |                       | | |           | |   |         |   |         |   |                   |     | |     | | |                   | |
   |   | |       |     |             |   |           |       |                       | | |           | |   |         |   |         |   |       +-----------+     | |     | | |                   | |
   |   | |       |     |             |   |           |       |                       | | |           | |   |         |   |         |   |       |                 | |     | H |                   | |
   |   | |       |     |             |   |           +-------------------------+     | | |           | |   |         |   |         |   |       |                 | |     | | |                   | |
   |   | |       |     |             |   |                   |                 |     | | |           | |   |         |   |         |   |       |                 | |     | | |                   | |
   |   | |       |     |             |   |                   |               +-|---------|-----------|-|-------------|---|-----------------------------------------+     | | |                   | |
   |   | |       |     |             |   |                   |               | |     | | |           | |   |         |   |         |   |       |                 |       | | |                   | |
   |   | |   +-+ +-----|-------------|-------------------------------------------------|-------------------------------------------|-------------------------------------|-|-|-------------------------+
   |   | |   | |       |             |   |                   |               | |     | | |           | |   |         |   |         |   |       |                 |       | | |                   | |   |
   +-----|---|-|-------+   +---------------------------------|-----------------------|-|-|-----------------|---------|---|---------|-----------|-------------------------|---|---------------+   | |   |
       | |   | |           |         |   |                   |               | |     | | |           | |   |         |   |         |   |       |                 |       | | |               |   | |   |
   +-----|---+ +-----------|---------|-----------------------|---------------|-------|-|-|-------------|---|---------|---|---------------------|-------------------+     | | |               |   | |   |
   |   | |                 |         |   |                   |               | |     | | |           | |   |         |   |         |   |       |                 | |     | | |               |   | |   |
   +-----|-------------------------------------------------------+           | |     | | |           | |   |         |   |         |   |       |                 | |     | | |               |   | |   |
       | |                 |         |   |                   |   |           | |     | | |           | |   |         |   |         |   |       |                 | |     | | |               |   | |   |
       | +---+             |       +-----------------------------+       +---|-|-----|-----------------|---|---------|---|---------|---|-----------------+       | |     | | |               |   | |   |
       |     |             |       | |   |                   |           |   | |     | | |           | |   |         |   |         |   |       |         |       | |     | | |               |   | |   |
       |     |             |     +---|---------------+       |           |   | |     | | |           | |   |         |   |         |   +-------------+   |       | |     | | |               |   | | +-+
       |     |             |     | | |   |           |       |           |   | |     | | |           | |   |         |   |         |           |     |   |       | |     | | |               |   | | |
     +-|-----------+       |     | | |   |           |       |   +-------------------|---|-------------|---|-------------|---------------------|---------|-+     | |     | | |               |   | | |
     | |     |     |       |     | | |   |           |       |   |       |   | |     | | |           | |   |         |   |         |           |     |   | |     | |     | | |               |   | | |
     | |     |     |       |     | | |   |           |       |   |       |   | | +---------------------|---|-----------------+     |           |     |   | |     | |     | | |             +-----|-+ |
     | |     |     |       |     | | |   |           |       |   |       |   | | |   | | |           | |   |         |   |   |     |           |     |   | |     | |     | | |             | |   |   |
     | +-----------|-------+     | | |   |           |       |   |       |   | | |   | | |           | |   |         |   |   |     |           |     |   | |     | |     | | |             | |   |   |
     |       |     |             | | |   |           |       |   |       |   | | |   | | |           | |   |         |   |   |     |           |     |   | |     | |     | | |             | |   |   |
     |       |     |             | | |   |           |       |   |       |   | | |   | | |           | |   |         |   |   +-----|-----------------|---|-|-------------|---|-------------|-|---+   |
     |       |     |             | | |   |           |       |   |       |   | | |   | | |           | |   |         |   |         |           |     |   | |     | |     | | |             | |       |
     |       |     |       +-------|-|---|-------------------------------|-----|-----|---|-----------|-|---|---------------------------------------------|-|-----|-----+ | | |             | |       |
     |       |     |       |     | | |   |           |       |   |       |   | | |   | | |           | |   |         |   |         |           |     |   | |     | |   | | | |             | |       |
     |       |     |       | +-+ | | |   |           |       |   |       |   | | |   | +-+           | |   +---------|-------------|-----------|---------|-|-----|---------|-------------------------+
     |       |     |       | | | | | |   |           |       |   |       |   | | |   |               | |             |   |         |           |     |   | |     | |   | | | |             | |
     | +-----|---------------|-----+ |   |           |       |   |       |   | | |   |               | |             |   |         |           |     |   | |     | |   | | | |             | |
     | |     |     |       | | | |   |   |           |       |   |       |   | | |   |               | |             |   |         |           |     |   | |     | |   | | | |             | |
     | | +-------------------|-|-|---|---|-----------+       |   |       |   | | |   |               | |           +-|-------------|-----------|---------|-------|-|-----|-------------+   | |
     | | |   |     |       | | | |   |   |                   |   |       |   | | |   |               | |           | |   |         |           |     |   | |     | |   | | | |         |   | |
     | | |   |     |       | | | | +-----|-----------------------|---------------|---|---------------|-------------------|---------|---+ +-----|-----------|-----|-----|-------------+ |   | |
     | | |   |     |       | | | | | |   |                   |   |       |   | | |   |               | |           | |   |         |   | |     |     |   | |     | |   | | | |       | |   | |
     | | |   |     |       | | | | | |   |                   +-----------|---|-------|-----------------|---------------------------|---|-|-----|---------|-|-----|-------|---|-------|-|-+ | |
     | | |   |     |       | | | | | |   |                       |       |   | | |   |               | |           | |   |         |   | |     |     |   | |     | |   | | | |       | | | | |
   +---|-|-------------------|-----|-|---------------------------------------|-------|---------------|-|-----------------|---------|-----|-----------|-----|-----|-|---|-|-|-|---------+ | +-----------+
   | | | |   |     |       | | | | | |   |                       |       |   | | |   |               | |           | |   |         |   | |     |     |   | |     | |   | | | |       |   |   |         |
   | | | |   |     |       | | | | | |   |                       |       |   | | |   |               | |           | |   +---------|---------------------+ |     | |   | | | |       |   |   |         |
   | | | |   |     |       | | | | | |   |                       |       |   | | |   |               | |           | |             |   | |     |     |     |     | |   | | | |       |   |   |         |
   | | | |   +---+ |       | | | | | |   |                       |       | +-|-+ |   |               +-|-----------------+         |   | | +---------|-----|-----|-----|---|-+     +-|---|-----------+ |
   | | | |       | |       | | | | | |   |                       |       | | |   |   |                 |           | |   |         |   | | |   |     |     |     | |   | | |       | |   |   |       | |
   | | | +---------|-----------|---|-------------------------------------|-|-|-------|-----------+     |           | |   |         |   | | |   |     |     |     | |   | | |       | |   |   |       | |
   | | |         | |       | | | | | |   |                       |       | | |   |   |           |     |           | |   |         |   | | |   |     |     |     | |   | | |       | |   |   |       | |
   | | |         | |       | | | | | |   |                       |       | | |   |   |           |     |           | |   +---------|-----|-----------|-----|---------------|-+     | |   |   |       | |
   | | |         | |       | | | | | |   |                       |       | | |   |   |           |     |           | |             |   | | |   |     |     |     | |   | | | |     | |   |   |       | |
 +---+ |         | |       | | | | | |   |                   +------------Y|-|---|---------------------------------|-|-------------|---|-|-----|-----------------------|---|-|-----|-----|-+ |       | |
 | |   |         | |       | | | | | |   |                   |   |       | | |   |   |           |     |           | |             |   | | |   |     |     |     | |   | | | |     | |   | | |       | |
 | |   |         | |   +---+ | | | | |   |                   |   |       | | |   |   |           |     |           | |             |   | | |   |     |     |     | |   | | | |     | |   | | |       | |
 | |   |         | |   |     | | | | |   |                   |   |       | | |   |   |           |     |           | |             |   | | |   |     |     |     | |   | | | |     | |   | | |       | |
 | |   |       +-|-|---|---+ | | | | |   |                   +-----------|-|-|---|---------+     |     |           | |             |   | | |   |     |     +-----|-----|---------+ | |   | | |       | |
 | |   |       | | |   |   | | | | | |   |                       |       | | |   |   |     |     |     |           | |             |   | | |   |     |           | |   | | | |   | | |   | | |       | |
 | |   |     +---|-|-------+ | | | | +-----------------------------------|-|---------|-----|-----------|-----------|-|---+         |   | | |   |     |           | |   | | | |   | | |   | | |       | |
 | |   |     | | | |   |     | | | |     |                       |       | | |   |   |     |     |     |           | |   |         |   | | |   |     |           | |   | | | |   | | |   | | |       | |
 | |   |     | | | | +---------|-|-------|-----------------------|-----+ | | |   |   |     +-----|-----------------|-------------------|-|-|-------+ |           +-----|---|-|---|-|-|-----+ |       | |
 | |   |     | | | | | |     | | | |     |                       |     | | | |   |   |           |     |           | |   |         |   | | |   |   | |             |   | | | |   | | |   |   |       | |
 | |   |     | | | | +-|-----|---|-|-----|-----------------------|-----|-------+ |   |           |     |           | |   |         |   | | |   |   | |             |   | | | |   | | |   |   | +---+ +-+
 | |   |     | | | |   |     | | | |     |                       |     | | | | | |   |           |     |           | |   |         |   | | |   |   | |             |   | | | |   | | |   |   | |   |
 | |   |     | | | |   |     | | | |     |                     +-|-----|---|-|-|-|-----------+   |     |           | |   +---------------|-----|---|---------------|---|-|---------|-|---+   | | +-|---+
 | |   |     | | | |   |     | | | |     |                     | |     | | | | | |   |       |   |     |           | |             |   | | |   |   | |             |   | | | |   | | |       | | | |   |
 | |   |     | | | |   |     | +---|-----|-----------+         | |     | | | | | |   | +---------|-----|-------------|---+         |   | | |   |   | |           +-----|-|-----+ | | +-+     | | | | +-+
 | |   |     | | | |   |     |   | |     |           |         | |     | | | | | |   | |     |   |     |           | |   |         |   | | |   |   | |           | |   | | | | | | |   |     | | | | |
 | |   |     +---|-|---|---+ |   | |     |           |         | |     | | | | | |   | |     |   |     |           | |   +---+     |   | | |   |   | |           | |   | | | | | | |   | +---|---|-|-+
 | |   |       | | |   |   | |   | |     |           |         | |     | | | | | |   | |     |   |     |           | |       |     |   | | |   |   | |           | |   | | | | | | |   | |   | | | |
 | |   |       | | |   |   | |   | |     |           |       +-|-|-----------|---------|-----|---|-----+         +-|-|-------|-----|-----|-|---------|-----------|-------|-|-|---------|-+   | | | |
 | |   |       | | |   |   | |   | |     |           |       | | |     | | | | | |   | |     |   |               | | |       |     |   | | |   |   | |           | |   | | | | | | |   |     | | | |
 | |   |       | | |   |   | |   | |     |           |       | | |     | | | | | +---------------|---------------|---|-----------------------------|---------------|-----|-|---|-------|-----|-|-------+
 | |   |       | | |   |   | |   | |     |           |       | | |     | | | | |     | |     |   |               | | |       |     |   | | |   |   | |           | |   | | | | | | |   |     | | | |   |
 | |   |       | | |   |   | |   | +-----|-------------------|---|-----|---|---------|-----------|---------------|-|-----+ +-------|-------|-+ |   | |           | |   | | | | | | |   |     | | | |   |
 | |   |       | | |   |   | |   |       |           |       | | |     | | | | |     | |     |   |               | | |   | | |     |   | | | | |   | |           | |   | | | | | | |   |     | | | |   |
 | |   |       | | |   |   | |   |       |           |       | | |     | | | +-|-------|-----|---|---------------|---------|-------|---|-|---|-|-----------------|-------|-|-|-|-|-|---|-------|---+ +-+
 | |   |       | | |   |   | |   |       |           |       | | |     | | |   |     | |     |   |               | | |   | | |     |   | | | | |   | |           | |   | | | | | | |   |     | | |   |
 | |   |     +---|-|-------------|-------|-----------------------|-----|-|-|-----+   | |     |   |               | | |   | | |     |   +-------+   | |           | |   | | | | | | |   +-+   | | |   |
 | |   |     | | | |   |   | |   |       |           |       | | |     | | |   | |   | |     |   |               | | |   | | |     |     | | |     | |           | |   | | | | | | |     |   | | |   |
 | |   |     | | | +---|---|-----|-------|-+         |       | | |     | | |   | |   | |     |   |               | | |   | | |     |     | | |     | |           | |   | | | | | | |     |   | | |   |
 | |   |     | | |     |   | |   |       | |         |       | | |     | | |   | |   | |     |   |               | | |   | | |     |     | | |     | |           | |   | | | | | | |     |   | | |   |
 | |   |     | | |     |   | |   |       | |         |   +-------|---------|---|-|-----|-------------------------|-|-|---+ | +-----|-----+ | |     | |           | |   | +-----+ +-|-----|---|-+ |   |
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     |   |               | | |     |       |       | |     | |           | |   |   | |     |     |   |   |   |
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | +-------------------|-------|---------+     | |     | |           | |   |   | | +-------------|-------+
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               | | |     |       | |     | |     | |           | |   |   | | |   |     |   |   |
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               | +-|-----|---------------|-------|---------------|-+ | +-|---|-+ +---------|---|---+
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | |     | |           | | | | | | | | |       |   |   |   |
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | |     | |           | | | | | | | | |       |   |   |   |
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | |     | |           | | | | | | | | |       |   |   |   |
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | |     | |           | | | | | | | | |       |   |   |   |
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | |     | |           | | | | | | | | |       |   |   |   |
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | | +-----|-------------|-------|-|-|---------|---|-----+ |
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | | |   | |           | | | | | | | | |       |   |   | | |
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | | |   | |           | | | | | | | | |       |   |   | | |
 | A   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | | |   | |           | | | | | | | | |       |   |   | | |
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | | |   | |           | | | | | | | | |       |   |   | | |
 | |   |     | | |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | | |   | |           | | | | | | | | |       |   |   | | |
 | |   |     | +-----------|-------------|-----------------------------|-|-----|-|---|-|-----|---|-----------------------------------|-------------|---------------------|-----|-+       |   |   | | |
 | |   |     |   |     |   | |   |       | |         |   |   | | |     | | |   | |   | |     | | |               |   |     |       | |     | | |   | |           | | | | | | | |         |   |   | | |
 | |   |     |   |     |   | |   |       | |         |   |   | | |     | | |   | |   | |   +---|-----------------|---|---------------|-----+ | |   | |           | | | | | | | |         |   |   | | |
 | |   |     |   |     |   | |   |       | |         |   |   | | |     | | |   | |   | |   | | | |               |   |     |       | |       | |   | |           | | | | | | | |         |   |   | | |
 | |   |     |   |     |   | |   |       | |         |   |   | | |     | | |   | |   | |   | | | |               |   |     |       | |       | |   | |           | | | | | | | |         |   |   | | |
 | |   |     |   |     |   | |   |       | |         |   |   | | |     | | |   | |   | |   | | | |               |   |     |       | |       | |   | |           | | | | | | | |         |   |   | | |
 | | +-------|---|-----|-------------------|-------------------|-|-------------|-|---------|-|-|-----------------|---|-------------|-|-+     | |   | |           | | | | | | | |         |   |   | | |
 | | | |     |   |     |   | |   |       | |         |   |   | | |     | | |   | |   | |   | | | |               |   |     |       | | |     | |   | |           | | | | | | | |         |   |   | | |
 | | | |     |   |     |   | |   |       | |         |   |   | | | +-------|---------|-----|-|-|-|---------------------------------|-|-|-----|-|-------------------|-+ +-|---+ |         |   |   | | |
 | | | |     |   |     |   | |   |       | |         |   |   | | | |   | | |   | |   | |   | | | |               |   |     |       | | |     | |   | |           | |     | |   |         |   |   | | |
 | | | |     |   |   +-----------------------------------|---|-|-------|-|-|---|-|---+ |   | | | |               |   |     |       | | |     | |   | |           | |     | |   |         |   |   | | |
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | |     |   | | | |               |   |     |       | | |     | |   | |           | |     | |   |         |   |   | | |
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | |     |   | | | |   +-----------|---------|-------|-------+ +-----+ |           | |     | +---|---------|---+   | | |
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | |     |   | | | |   |           |   |     |       | | |   |   |     |           | |     |     |         |       | | |
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | | +-------|-|-|-----|-----------|-------------------|---------------|-----------|-------------|---------|---------+ |
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | | |   |   | | | |   |           |   |     |       | | |   |   |     |           | |     |     |         |       |   |
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | | |   |   | | | |   |           |   |     |       | | |   |   |     |           | |     |     |         |       |   |
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | | |   |   | | | |   |           |   |     |       | | |   |   |     |           | |     |     |         |       |   |
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | | |   |   | | | |   |           |   |     |       | | |   |   |     |         +---|-----|-----+         |       |   |
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | | |   |   | | | |   |           |   |     |       | | |   |   |     |         | | |     |               |       |   |
 | | | |     |   |   | |   | |   |       | |         |   |   | | | |   | | |   | | |   |   | | | |   |           |   |     |       | | |   |   |     |         | | |     |               |       |   |
 | | | |     |   |   B |   | |   |       | |         |   |   | | | |   | | |   | | |   |   | | | |   |           |   |     |       | | |   |   |     |         | | |     |               |       |   |
 | | | |     |   |   | |   | |   |       | |   +-----|---|---|-----------------------------+ | | |   |           |   |     |       | | |   |   |     |         | | |     |               |       |   |
 | | | |     |   |   | |   | |   |       | |   |     |   |   | | | |   | | |   | | |   |     | | |   |           |   |     |       | | |   |   |     |         | | |     |               |       |   |
 | | | |     |   |   | |   +-|---|-------|-------------------------|---|-------|-|-|-------------+   |           |   |     |       | | |   |   |     |         | | |     |               |       |   |
 | | | |     |   |   | |     |   |       | |   |     |   |   | | | |   | | |   | | |   |     | |     |           |   |     |       | | |   |   |     |         | | |     |               |       |   |
 | | | |     +-------|-|-----|---|-------|-----+     |   |   | | | |   | | |   | | |   |     | |     |         +-|---|---------------|-|---|---|-----|---------|---------------+         |       |   |
 | | | |         |   | |     |   |       | |         |   |   | | | |   | | |   | | |   |     | |     |         | |   |     |       | | |   |   |     |         | | |     |     |         |       |   |
 +-|-----------+ |   +-------|---|-------|---------------|---------------|-------|-----------|-------|---------|-|---|-----|-------|---|-------|-----|-----+   | | |     |     |         |       |   |
   | | |       | |     |     |   |       | |         |   |   | | | |   | | |   | | |   |     | |     |         | |   |     |       | | |   |   |     |     |   | | |     |     |         |       |   |
 +-|---+       | |     +-----------------------------|---|-----|-|-|---|---+   | | |   +---+ +-------|---------|-|---------|---------|-+   |   |     |     |   | +-|-----------|---------------+ |   |
 | | |         | |           |   |       | |         |   |   | | | |   | |     | | |       |   |     |         | |   |     |       | |     |   |     |     |   |   |     |     |         |     | |   |
 | | |         | |           |   |       | |     +---|-------|-----|-----|-+   | | |       |   |     |         | |   |     |       | |     |   |     |     |   |   |     |     |         |     | |   |
 | | |         | |           |   |       | |     |   |   |   | | | |   | | |   | | |       |   |     |         | |   |     |       | |     |   |     |     |   |   |     |     |         |     | |   |
 | | |         +-|-+     +---------------|-|-----|-------|---|-|-|-+   | | +-----|-------+ +---------|-+       | |   |     |       | |     |   |     |     |   |   |     |     |         |     | |   |
 | | |           | |     |   |   |       | |     |   |   |   | | |     | |     | | |     |     |     | |       | |   |     |       | |     |   |     |     |   |   |     |     |         |     | |   |
 | | |     +-----|-|---------|---|-------|-|-----|---|---------------------------+ |     |     |     +---------|-|---|---------------|-----|---------+     |   |   |     |   +-|---------|-----|-|-+ |
 | | |     |     | |     |   |   |       | |     |   |   |   | | |     | |     |   |     |     |       |       | |   |     |       | |     |   |           |   |   |     |   | |         |     | | | |
 | | |     |     | |     |   |   |       | |   +-----|-----------|-------|-+   | +-|-----|-----|-------|-------------|-----|-------|-------|---|---------------|---|-----------|---------|-----|-+ | |
 | | |     |     | |     |   |   |       | |   | |   |   |   | | |     | | |   | | |     |     |       |       | |   |     |       | |     |   |           |   |   |     |   | |         |     |   | |
 | | | +---|-----|-----------|---|-------|-------|---|---|-----|-|-------------|---------|---------------------|-|-------------------------+   |           |   |   |     |   | |         |     +---+ |
 | | | |   |     | |     |   |   |       | |   | |   |   |   | | |     | | |   | | |     |     |       |       | |   |     |       | |         |           |   |   |     |   | |         |           |
 | | | |   |     | |     |   +---|---------------|-+ |   |   | | |     | | |   | | | +---|-----|-------|-------------|-----------------------------------------|---|---------|---+       |           |
 | | | |   |     | |     |       |       | |   | | | |   |   | | |     | | |   | | | |   |     |       |       | |   |     |       | |         |           |   |   |     |   | | |       |           |
 | | | | +-|---+ | |     |       |       | |   +-|-|-----|-----------------|---+ | | |   |     |       |       | |   |     |       | |         |           |   |   |     |   | | |       |           |
 | | | | | |   | | |     |       |       | |     | | |   |   | | |     | | |     | | |   |     |       |       | |   |     |       | |         |           |   |   |     |   | | |       |           |
 | | +-----|-------|-----|---------------|-------|-|-------------|-----|-----------|-|-------------------------|-----|-----|-------|-----------|-----------|---|---|--------M|---+     +-|-----------|-+
 | |   | | |   | | |     |       |       | |     | | |   |   | | |     | | |     | | |   |     |       |       | |   |     |       | |         |           |   |   |     |   | |       | |           | |
 | | +-|-------|-|-------|-------|---------|---------|---------------------|---------|---|-+   |       +-------|-----------|-------|-----------|-------------------|-----|-+ | |     +---+           | |
 | | | | | |   | | |     |       |       | |     | | |   |   | | |     | | |     | | |   | |   |               | |   |     |       | |         |           |   |   |     | | | |     | |             | |
 | | +-+ +---------|-------+     |       | |     | | |   |   | | | +---+ | |   +-|-|-|---+ +---------------------+   |     |       | |         |           |   |   |     | | | |     | |             | |
 | |       |   | | |     | |     |       | |     | | |   |   | | | |     | |   | | | |         |               |     |     |       | |         |           |   |   |     | | | |     | |             | |
 | |     +-|---|-|-------------------------|-------|---------|-|-|-|-----------|---+ +-------------------+ +---------|-----+       | |         |           |   |   |     | | | |     | |             | |
 | |     | |   | | |     | |     |       | |     | | |   |   | | | |     | |   | |             |         | |   |     |             | |         |           |   |   |     | | | |     | |             | |
 | |     | |   | | |     | |     |       | |     | | |   |   | | | |     | |   | |             |         | |   |     |             | |         |           |   |   |     | | +---------|-----------+ | |
 | |     | |   | | |     | |     |       | |     | | |   |   | | | |     | |   | |             |         | |   |     |             | |         |           |   |   |     | |   |     | |           | | |
 | |     | |   | | |     | |     |       | |     | | |   |   | | | |     | |   | |             |         | |   |     +---------------|---------+   +-------|---|---------|-+ +-|-------|-+         | | |
 | |     | |   | | |     | |     |       | |     | | |   |   | | | |     | |   | |             |         | |   |                   | |             |       |   |   |     |   | |     | | |         | | |
 | |     | |   | | |     | |     |       | |     | | |   |   | | | +-----------|-+             |         | +---|---------+         | |             |       |   |   |     |   | |     | | |         | | |
 | |     | |   | | |     | |     |       | |     | | |   |   | | |       | |   |               |         |     |         |         | |             |       |   |   |     |   | |     | | |         | | |
 | | +-----+   +-|-+     | |     |       | |     | | |   |   | | |       | +---+       +-----------------------------------------------------------------------|-----------+ | |   +---|-|-------------+
 | | |   |       |       | |     |       | |     | | |   |   | | |       |             |       |         |     |         |         | |             |       |   |   |     | | | |   | | | |         | |
 | | |   |       |       +---------------|-------|---|---------------------------------+       |         |     |     +---+         | |             |   +-------------+   | | | |   +---|-|-------------Z
 | | |   |       |         |     |       | |     | | |   |   | | |       |                     |         |     |     |             | |             |   |   |   |   | |   | | | |     | | |         | |
 | +-|---+       |       +-|-----+       | |     | | |   |   | | |       |                     |         +-------------------------|-------------+ +---|---|---|---------------|-----|-+ +-----+   +-|-+
 |   |           |       | |             | |     | | |   |   | | |       |                     |               |     |             | |           |     |   |   |   | |   | | | |     |         |     | |
 |   |     +-----|-------|-+         +---|-------|-------------|-|-------|-------------------------------------|-------------------|-|-----------|-----|-------|---|-|-------|-|---------------|-----|-+
 |   |     |     |       |           |   | |     | | |   |   | | |       |                     |               |     |             | |           |     |   |   |   | |   | | | |     |         |     |
 |   |     |     |       |     +-----------------|-|-|-------------------+         +-----------|---------------------|-------------|-------------+     |   |   +---|-|---+ | | |     |         |     |
 |   |     |     |       |     |     |   | |     | | |   |   | | |                 |           |               |     |             | |                 |   |       | |     | | |     |         |     |
 |   +-------------------|-----------|---+ |     | +---+ +-------|-----------------+           |               |     +-+           +-|-----+           |   +-------------------|---+ +-----------------+
 |         |     |       |     |     |     |     |   | |     | | |                             |               |       |             |     |           |           | |     | | |   |           |     | |
 |         |     |       +-----------------|-------------+   | | |                             +-------------+ +-------+             | +---|-------------------------------+ | +---|-----+     +-----|-+
 |         |     |             |     |     |     |   | | |   | | |                                           |                       | |   |           |           | |       |     |     |           |
 |         |     |             |     +-----------|---|---|---|-+ |                                           |                       | +---|-----------|-----------+ |       |     |     |           |
 |         |     |             |           |     |   J | |   |   |                                           |                       |     |           |             |       |     |     |           |
 +---------|-----|-------------|-----------|---------|-|-----|-----------------------------------------------|-----------------------|-----|---------------------------------------------|-+         |
           |     |             |           |     |   | | |   |   |                                           |                       |     |           |             |       |     |     | |         |
           |     |   +---------+     +-+   +-----+   | | |   |   |       +-----------------------------------+       +---------------+     |           |           +---------|-----------+ |         |
           |     |   |               | |             | | |   |   |       |                                           |                     |           |           | |       |     |       |         |
           +-----|-------------------+ |             | | | +-------------+ +---------------------------------------------------------------+           +-----------+ +-------+     +---+   +---------+
                 |   |                 |             | | | | |   |         |                                         |                                                                 |
                 +---+                 +-------------+ +-+ +-+   +---------+                                         +-----------------------------------------------------------------+

""".trim { it == '\n' }

    val routing = input.lines().map { it.toList() }.pad(1, {' '})
    var pos: Pos = Pos(routing[1].indexOf('|'), 1)
    var dir: Dir = Dir.DOWN
    val seen: MutableList<Char> = mutableListOf()
    var part2 = 0

    outer@
    while (true) {
        val c = routing[pos]
        when (c) {
            ' ' -> break@outer
            in "|-" -> {}
            in 'A'..'Z' -> seen += c
            '+' -> {
                if (routing[pos + dir.turnLeft] != ' ')
                    dir = dir.turnLeft
                else
                    dir = dir.turnRight
            }
        }
        pos += dir
        part2++
    }
    val part1 = seen.joinToString("")

    println(part1)
    println(part2)
}
